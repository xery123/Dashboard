<div *ngIf="jobsId; else cargando">
  <div class="container-fluid mt-3">
    <div class="col-12">
      <div class="table-responsive">
        <div class="divTable blueTable">
          <div class="divTableHeading">
            <div class="divTableRow">
              <div class="divTableHead text-center">ID</div>
              <div class="divTableHead text-center">Last task</div>
              <div class="divTableHead text-center">Next execution</div>
              <div class="divTableHead text-center">Number of runs</div>
              <div class="divTableHead text-center">Status</div>
              <div class="divTableHead text-center">Job Actions</div>
              <div class="divTableHead text-center">Module Actions</div>
            </div>
          </div>
          <div
            *ngFor="
              let job of jobsId.data.jobsSummary | keyvalue;
              let i = index
            "
            class="divTableBody"
          >
            <div class="divTableRow">
              <div class="divTableCell">
                <div class="text-center">{{ job.key }}</div>
                <hr />
                <div class="text-center">
                  Started: {{ job.value.startedAt }}
                </div>
                <div class="text-center">
                  Started First Run: {{ job.value.firstRunAt }}
                </div>
              </div>
              <div class="divTableCell text-center">
                <div>Last Run Started:</div>
                <div>{{ job.value.lastRunStartedAt }}</div>
                <div>Last Run Ended:</div>
                <div>{{ job.value.lastRunEndedAt }}</div>
              </div>
              <div class="divTableCell text-center">
                {{ job.value.nextExecutionAt }}
              </div>
              <div class="divTableCell text-center">
                <div>
                  <button
                    class="btn btn-link"
                    (click)="handleQueueClick(job.key, modalHistory)"
                  >
                    {{ job.value.numberOfRuns }}
                  </button>
                </div>
                @if(historyFinished[job.key]) {
                <div
                  *ngIf="
                    historyFinished[job.key].length > 0 &&
                    historyFinished[job.key][0].history.length > 0
                  "
                >
                  <button
                    class="btn btn-link"
                    (click)="handleQueueClick(job.key, modalHistoryFinished)"
                  >
                    Slow executions finished
                  </button>
                </div>
                } @if(historyProgress[job.key]) {
                <div
                  *ngIf="
                    historyProgress[job.key].length > 0 &&
                    historyProgress[job.key][0].history.length > 0
                  "
                >
                  <button
                    class="btn btn-link"
                    (click)="handleQueueClick(job.key, modalHistoryProgresss)"
                  >
                    Slow executions in progress
                  </button>
                </div>
                }
              </div>
              <div class="divTableCell text-center">
                <span [ngSwitch]="job.value.jobStatus">
                  <span *ngSwitchCase="'STOPPED'" class="no">STOPPED</span>
                  <span *ngSwitchCase="'SCHEDULED'" class="yes">SCHEDULED</span>
                  <span *ngSwitchCase="'RUNNING'" class="running">RUNNING</span>
                  <span *ngSwitchDefault>{{ job.value.jobStatus }}</span>
                </span>
              </div>

              <div class="divTableCell text-center">
                <app-start-stop-remove-job
                  (refresh)="onRefresh1()"
                  [jobId]="job.key"
                  [jobStatus]="job.value.jobStatus"
                  [jobStarted]="job.value.startedAt"
                  [moduleStatus]="job.value.moduleStatus"
                ></app-start-stop-remove-job>
              </div>
              <div class="divTableCell text-center">
                <app-enable-disable-job
                  (refreshEnableDisable)="onRefresh2()"
                  [jobId]="job.key"
                  [moduleStatus]="job.value.moduleStatus"
                ></app-enable-disable-job>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #cargando>
  <p>Cargando datos...</p>
</ng-template>
